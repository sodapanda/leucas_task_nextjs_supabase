(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[632],{8440:function(e,a,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/tasklist",function(){return s(6277)}])},6277:function(e,a,s){"use strict";s.r(a),s.d(a,{default:function(){return C}});var t=s(5893),n=s(8049),i=s(1017),r=s(61),l=s(4127),d=s(1365),c=s(4777),o=s(2615),u=s(7841),m=s(7564),x=s(1232),h=s(5117),p=s(9876),f=s(4523),j=s(7328),k=s(1759),g=s(9834),w=s(3991),v=s(7294),_=s(4053),y=s(1163);function C(){var e;let a=(0,_.useUser)(),s=(0,_.useSupabaseClient)(),C=(0,y.useRouter)(),[b,z]=(0,v.useState)(""),[S,T]=(0,v.useState)(""),[E,R]=(0,v.useState)([]),[q,A]=(0,v.useState)(""),[N,P]=(0,v.useState)(5),[Y,B]=(0,v.useState)([]),[I,{open:K,close:X}]=(0,k.q)(!1),[Z,O]=(0,v.useState)({}),[F,U]=(0,v.useState)(!1),[W,D]=(0,v.useState)(""),[G,H]=(0,v.useState)({}),[J,L]=(0,v.useState)([]),[M,Q]=(0,v.useState)([]),[V,$]=(0,v.useState)({});async function ee(){let{data:e,error:a}=await s.from("tasktype").select("*");a&&alert(a.message),e.forEach(e=>{e.label=e.tasktypename,e.value=e.tasktypename}),R(e)}async function ea(){let{data:e,error:a}=await s.from("tasks").select("*").order("id",{ascending:!1});if(console.log(e),!a&&e){let a=e.reduce((e,a)=>{let s=e.find(e=>e.tasktype===a.tasktype);return s?s.list.push(a):e.push({tasktype:a.tasktype,list:[a]}),e},[]);console.log(a),B(a)}}async function es(){let{data:e,error:a}=await s.from("task_stack_view").select("*").order("id",{ascending:!1});if(a){alert(a.message);return}L(e)}async function et(){let{data:e,error:a}=await s.from("idea").select("*");if(a){alert(a.message);return}e.forEach(e=>{e.label=e.idea_name,e.value=e.idea_name}),Q(e)}return(0,v.useEffect)(()=>{ee(),ea(),es(),et()},[]),(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.u,{opened:I,onClose:X,children:(0,t.jsxs)(i.Z,{shadow:"sm",padding:"lg",radius:"md",withBorder:!0,children:[(0,t.jsx)(r.o,{placeholder:"task name",value:Z.task_name,onChange:e=>{O({...Z,task_name:e.target.value})}}),(0,t.jsx)(l.Y,{value:Z.power,onChange:async e=>{O({...Z,power:e})}}),(0,t.jsx)(d.Ph,{label:"哪个idea",data:M,value:(null===(e=M.find(e=>e.id===Z.idea_id))||void 0===e?void 0:e.idea_name)||"",onChange:e=>{let a=M.find(a=>a.idea_name===e);O({...Z,idea_id:a.id})}}),(0,t.jsx)(c.i,{my:"sm",variant:"dashed"}),(0,t.jsx)(o.g,{placeholder:"Your comment",label:"随手记录",autosize:!0,minRows:2,maxRows:10,value:Z.step,onChange:e=>{let a=e.currentTarget.value;O({...Z,step:a})}}),(0,t.jsx)(o.g,{placeholder:"功能列表",label:"功能和好处列表为了推广文案用",autosize:!0,minRows:2,maxRows:10,value:Z.features?Z.features:"",onChange:e=>{let a=e.currentTarget.value;O({...Z,features:a})}}),(0,t.jsx)(o.g,{placeholder:"最新进展",label:"当前",autosize:!0,minRows:2,maxRows:10,value:Z.current_frame,onChange:e=>{let a=e.currentTarget.value;O({...Z,current_frame:a})}}),(0,t.jsx)(c.i,{my:"sm",variant:"dashed"}),(0,t.jsx)(u.z,{variant:"light",color:"blue",fullWidth:!0,mt:"md",radius:"md",onClick:async()=>{await s.from("tasks").update({power:Z.power,step:Z.step,current_frame:Z.current_frame,task_name:Z.task_name,idea_id:Z.idea_id,features:Z.features}).eq("id",Z.id),ea(),X()},children:"save"})]})}),(0,t.jsx)(n.u,{opened:F,onClose:()=>{U(!1),H({})},children:(0,t.jsx)(i.Z,{shadow:"sm",padding:"lg",radius:"md",withBorder:!0,children:(0,t.jsxs)(m.K,{children:[(0,t.jsx)(r.o,{label:"note",placeholder:"卡在哪了",value:W,onChange:e=>{D(e.target.value)}}),(0,t.jsx)(u.z,{onClick:async()=>{await s.from("task_stack").insert([{note:W,task_id:G.id,user_id:a.id}]),U(!1),es()},children:"add"})]})})}),(0,t.jsxs)("div",{className:"w-ful mt-4 ml-4 mr-4",children:[E.map(e=>(0,t.jsxs)(x.Z,{mb:"xs",ml:"xs",children:[(0,t.jsx)(g.A,{color:"blue",radius:"xl",variant:"light",onClick:async()=>{let{data:a,error:t}=await s.from("tasktype").delete().eq("id",e.id);t&&alert("".concat(t.message)),ee()},children:(0,t.jsx)(w.IT9,{size:"1rem"})}),(0,t.jsx)(h.x,{fz:"sm",children:e.tasktypename})]},e.id)),(0,t.jsx)(r.o,{placeholder:"添加任务类型",value:b,onChange:e=>{z(e.currentTarget.value)}}),(0,t.jsx)(p.k,{mt:"xs",gap:"sm",justify:"flex-end",align:"center",direction:"row",wrap:"nowrap",children:(0,t.jsx)(u.z,{disabled:!b,onClick:async()=>{let{data:e,error:t}=await s.from("tasktype").insert([{tasktypename:b,user_id:a.id}]);t&&alert(t.message),z(""),ee()},children:"add"})}),(0,t.jsx)(c.i,{my:"sm",variant:"dashed"}),(0,t.jsx)(d.Ph,{label:"选择任务类型",value:S,data:E,onChange:T}),(0,t.jsx)(d.Ph,{label:"哪个idea",data:M,value:V.idea_name?V.idea_name:"",onChange:e=>{let a=M.find(a=>a.idea_name===e);$(a)}}),(0,t.jsx)(r.o,{label:"任务",value:q,onChange:e=>{A(e.currentTarget.value)}}),(0,t.jsx)(l.Y,{label:"优先级",value:N,onChange:P}),(0,t.jsx)(p.k,{mt:"xs",gap:"sm",justify:"flex-end",align:"center",direction:"row",wrap:"nowrap",children:(0,t.jsx)(u.z,{disabled:!S||!q,onClick:async()=>{await s.from("tasks").insert([{power:N,task_name:q,user_id:a.id,tasktype:S,idea_id:V.id,step:"init"}]),T(""),A(""),$({}),ea()},children:"add"})}),(0,t.jsx)(c.i,{my:"sm",variant:"dashed"}),(0,t.jsx)(m.K,{children:J.map((e,a)=>(0,t.jsxs)(p.k,{gap:"xs",justify:"center",align:"center",direction:"row",wrap:"nowrap",children:[0===a&&(0,t.jsx)(g.A,{color:"blue",radius:"xl",variant:"light",onClick:async()=>{await s.from("task_stack").delete().eq("id",e.id),es()},children:(0,t.jsx)(w.IT9,{size:"1rem"})}),(0,t.jsx)(h.x,{fz:"xs",children:"".concat(e.task_name," / ").concat(e.current_frame," / ").concat(e.note)})]},e.id))}),(0,t.jsx)(c.i,{my:"sm",variant:"dashed"}),(0,t.jsx)(h.x,{c:"blue",children:"注意：同一个任务分类下最好只有一个是激活状态，不然时间不够分的"}),Y.map(e=>(0,t.jsxs)(f.x,{component:"div",mt:"md",mb:"sm",children:[(0,t.jsx)(h.x,{mt:"sm",fz:"lg",fw:500,c:"dimmed",children:e.tasktype}),e.list.map(e=>(0,t.jsxs)(f.x,{component:"div",children:[(0,t.jsxs)(p.k,{justify:"flex-start",gap:"xs",align:"center",direction:"row",wrap:"nowrap",children:[(0,t.jsx)(g.A,{color:"blue",radius:"xl",variant:"light",onClick:()=>{O({...e}),K()},children:(0,t.jsx)(w.TRY,{size:"1rem"})}),(0,t.jsx)(g.A,{color:"blue",radius:"xl",variant:"light",onClick:async()=>{H(e),U(!0)},children:(0,t.jsx)(w.Kjm,{size:"1rem"})}),(0,t.jsx)(g.A,{color:"blue",radius:"xl",variant:"light",onClick:async()=>{await s.from("tasks").delete().eq("id",e.id),ea()},children:(0,t.jsx)(w.IT9,{size:"1rem"})}),(0,t.jsx)(g.A,{color:"blue",radius:"xl",variant:"light",onClick:async()=>{C.push({pathname:"/story",query:{taskid:e.id}})},children:(0,t.jsx)(w.Bpt,{size:"1rem"})}),(0,t.jsx)(h.x,{fz:"sm",fw:700,c:"blue",children:e.power}),(0,t.jsx)(j.X,{label:e.task_name,checked:e.active,onChange:async a=>{let t=a.currentTarget.checked;console.log("task id ".concat(e.id," checked ").concat(t)),await s.from("tasks").update({active:t}).eq("id",e.id),ea()}})]}),(0,t.jsx)(h.x,{fz:"xs",c:"dimmed",mx:"xl",truncate:!0,lineClamp:1,children:e.step}),(0,t.jsx)(c.i,{my:"sm",variant:"dashed"})]},e.id))]},e.tasktype))]})]})}}},function(e){e.O(0,[584,967,874,566,774,888,179],function(){return e(e.s=8440)}),_N_E=e.O()}]);