(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[632],{8440:function(e,a,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/tasklist",function(){return s(6277)}])},6277:function(e,a,s){"use strict";s.r(a),s.d(a,{default:function(){return y}});var t=s(5893),n=s(8049),i=s(1017),r=s(4127),l=s(61),d=s(7841),c=s(1232),o=s(5117),u=s(9876),m=s(4777),p=s(1365),x=s(4523),h=s(7328),f=s(1759),k=s(9834),j=s(3991),w=s(7294),g=s(4053);function y(){let e=(0,g.useUser)(),a=(0,g.useSupabaseClient)(),[s,y]=(0,w.useState)(""),[v,C]=(0,w.useState)(""),[b,_]=(0,w.useState)([]),[z,T]=(0,w.useState)(""),[S,E]=(0,w.useState)(5),[N,q]=(0,w.useState)([]),[A,{open:P,close:X}]=(0,f.q)(!1),[Y,Z]=(0,w.useState)({});async function I(){let{data:e,error:s}=await a.from("tasktype").select("*");s&&alert(s.message),e.forEach(e=>{e.label=e.tasktypename,e.value=e.tasktypename}),_(e)}async function O(){let{data:e,error:s}=await a.from("tasks").select("*").order("id",{ascending:!1});if(console.log(e),!s&&e){let a=e.reduce((e,a)=>{let s=e.find(e=>e.tasktype===a.tasktype);return s?s.list.push(a):e.push({tasktype:a.tasktype,list:[a]}),e},[]);console.log(a),q(a)}}return(0,w.useEffect)(()=>{I(),O()},[]),(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.u,{opened:A,onClose:X,children:(0,t.jsxs)(i.Z,{shadow:"sm",padding:"lg",radius:"md",withBorder:!0,children:[(0,t.jsx)(r.Y,{value:Y.power,onChange:async e=>{Z({...Y,power:e})}}),(0,t.jsx)(l.o,{value:Y.step,label:"当前步骤",onChange:e=>{let a=e.currentTarget.value;Z({...Y,step:a})}}),(0,t.jsx)(d.z,{variant:"light",color:"blue",fullWidth:!0,mt:"md",radius:"md",onClick:async()=>{await a.from("tasks").update({power:Y.power,step:Y.step}).eq("id",Y.id),O(),X()},children:"save"})]})}),(0,t.jsxs)("div",{className:"w-ful mt-4",children:[b.map(e=>(0,t.jsxs)(c.Z,{mb:"xs",ml:"xs",children:[(0,t.jsx)(k.A,{color:"blue",radius:"xl",variant:"light",onClick:async()=>{let{data:s,error:t}=await a.from("tasktype").delete().eq("id",e.id);t&&alert("".concat(t.message)),I()},children:(0,t.jsx)(j.IT9,{size:"1.125rem"})}),(0,t.jsx)(o.x,{fz:"sm",children:e.tasktypename})]},e.id)),(0,t.jsx)(l.o,{placeholder:"添加任务类型",value:s,onChange:e=>{y(e.currentTarget.value)}}),(0,t.jsx)(u.k,{mt:"xs",gap:"sm",justify:"flex-end",align:"center",direction:"row",wrap:"nowrap",children:(0,t.jsx)(d.z,{disabled:!s,onClick:async()=>{let{data:t,error:n}=await a.from("tasktype").insert([{tasktypename:s,user_id:e.id}]);n&&alert(n.message),y(""),I()},children:"add"})}),(0,t.jsx)(m.i,{my:"sm",variant:"dashed"}),(0,t.jsx)(p.Ph,{label:"选择任务类型",value:v,data:b,onChange:C}),(0,t.jsx)(l.o,{label:"任务",value:z,onChange:e=>{T(e.currentTarget.value)}}),(0,t.jsx)(r.Y,{label:"优先级",value:S,onChange:E}),(0,t.jsx)(u.k,{mt:"xs",gap:"sm",justify:"flex-end",align:"center",direction:"row",wrap:"nowrap",children:(0,t.jsx)(d.z,{disabled:!v||!z,onClick:async()=>{await a.from("tasks").insert([{power:S,task_name:z,user_id:e.id,tasktype:v,step:"init"}]),C(""),T(""),O()},children:"add"})}),(0,t.jsx)(m.i,{my:"sm",variant:"dashed"}),N.map(e=>(0,t.jsxs)(x.x,{component:"div",children:[(0,t.jsx)(o.x,{mt:"sm",fz:"lg",fw:500,c:"dimmed",children:e.tasktype}),e.list.map(e=>(0,t.jsxs)(x.x,{component:"div",children:[(0,t.jsxs)(c.Z,{position:"apart",mx:"xs",children:[(0,t.jsxs)(u.k,{gap:"sm",justify:"flex-start",align:"center",direction:"row",wrap:"nowrap",children:[(0,t.jsx)(h.X,{label:e.task_name,checked:e.active,onChange:async s=>{let t=s.currentTarget.checked;console.log("task id ".concat(e.id," checked ").concat(t)),await a.from("tasks").update({active:t}).eq("id",e.id),O()}}),(0,t.jsx)(o.x,{fz:"sm",fw:700,c:"dimmed",children:e.power})]}),(0,t.jsxs)(u.k,{gap:"sm",justify:"flex-start",align:"center",direction:"row",wrap:"nowrap",children:[(0,t.jsx)(k.A,{color:"blue",radius:"xl",variant:"light",onClick:()=>{Z({...e}),P()},children:(0,t.jsx)(j.TRY,{size:"1.125rem"})}),(0,t.jsx)(k.A,{color:"blue",radius:"xl",variant:"light",onClick:async()=>{await a.from("tasks").delete().eq("id",e.id),O()},children:(0,t.jsx)(j.IT9,{size:"1.125rem"})})]})]}),(0,t.jsx)(o.x,{fz:"xs",c:"dimmed",mx:"xl",truncate:!0,lineClamp:1,children:e.step})]},e.id))]},e.tasktype))]})]})}}},function(e){e.O(0,[584,402,117,774,888,179],function(){return e(e.s=8440)}),_N_E=e.O()}]);