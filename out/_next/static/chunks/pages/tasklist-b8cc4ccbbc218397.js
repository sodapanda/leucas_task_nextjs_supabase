(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[632],{8440:function(e,a,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/tasklist",function(){return s(6277)}])},6277:function(e,a,s){"use strict";s.r(a),s.d(a,{default:function(){return _}});var t=s(5893),n=s(8049),r=s(1017),i=s(61),l=s(4127),d=s(4777),c=s(2615),o=s(7841),u=s(7564),m=s(1232),x=s(5117),h=s(9876),p=s(1365),k=s(4523),j=s(7328),f=s(1759),g=s(9834),w=s(3991),y=s(7294),v=s(4053);function _(){let e=(0,v.useUser)(),a=(0,v.useSupabaseClient)(),[s,_]=(0,y.useState)(""),[C,b]=(0,y.useState)(""),[z,S]=(0,y.useState)([]),[T,E]=(0,y.useState)(""),[q,N]=(0,y.useState)(5),[A,R]=(0,y.useState)([]),[Y,{open:I,close:K}]=(0,f.q)(!1),[P,X]=(0,y.useState)({}),[Z,B]=(0,y.useState)(!1),[O,F]=(0,y.useState)(""),[U,W]=(0,y.useState)({}),[D,G]=(0,y.useState)([]);async function H(){let{data:e,error:s}=await a.from("tasktype").select("*");s&&alert(s.message),e.forEach(e=>{e.label=e.tasktypename,e.value=e.tasktypename}),S(e)}async function J(){let{data:e,error:s}=await a.from("tasks").select("*").order("id",{ascending:!1});if(console.log(e),!s&&e){let a=e.reduce((e,a)=>{let s=e.find(e=>e.tasktype===a.tasktype);return s?s.list.push(a):e.push({tasktype:a.tasktype,list:[a]}),e},[]);console.log(a),R(a)}}async function L(){let{data:e,error:s}=await a.from("task_stack_view").select("*").order("id",{ascending:!1});if(s){alert(s.message);return}G(e)}return(0,y.useEffect)(()=>{H(),J(),L()},[]),(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.u,{opened:Y,onClose:K,children:(0,t.jsxs)(r.Z,{shadow:"sm",padding:"lg",radius:"md",withBorder:!0,children:[(0,t.jsx)(i.o,{placeholder:"task name",value:P.task_name,onChange:e=>{X({...P,task_name:e.target.value})}}),(0,t.jsx)(l.Y,{value:P.power,onChange:async e=>{X({...P,power:e})}}),(0,t.jsx)(d.i,{my:"sm",variant:"dashed"}),(0,t.jsx)(c.g,{placeholder:"Your comment",label:"随手记录",autosize:!0,minRows:2,maxRows:10,value:P.step,onChange:e=>{let a=e.currentTarget.value;X({...P,step:a})}}),(0,t.jsx)(c.g,{placeholder:"最新进展",label:"当前",autosize:!0,minRows:2,maxRows:10,value:P.current_frame,onChange:e=>{let a=e.currentTarget.value;X({...P,current_frame:a})}}),(0,t.jsx)(d.i,{my:"sm",variant:"dashed"}),(0,t.jsx)(o.z,{variant:"light",color:"blue",fullWidth:!0,mt:"md",radius:"md",onClick:async()=>{await a.from("tasks").update({power:P.power,step:P.step,current_frame:P.current_frame,task_name:P.task_name}).eq("id",P.id),J(),K()},children:"save"})]})}),(0,t.jsx)(n.u,{opened:Z,onClose:()=>{B(!1),W({})},children:(0,t.jsx)(r.Z,{shadow:"sm",padding:"lg",radius:"md",withBorder:!0,children:(0,t.jsxs)(u.K,{children:[(0,t.jsx)(i.o,{label:"note",placeholder:"卡在哪了",value:O,onChange:e=>{F(e.target.value)}}),(0,t.jsx)(o.z,{onClick:async()=>{await a.from("task_stack").insert([{note:O,task_id:U.id,user_id:e.id}]),B(!1),L()},children:"add"})]})})}),(0,t.jsxs)("div",{className:"w-ful mt-4",children:[z.map(e=>(0,t.jsxs)(m.Z,{mb:"xs",ml:"xs",children:[(0,t.jsx)(g.A,{color:"blue",radius:"xl",variant:"light",onClick:async()=>{let{data:s,error:t}=await a.from("tasktype").delete().eq("id",e.id);t&&alert("".concat(t.message)),H()},children:(0,t.jsx)(w.IT9,{size:"1rem"})}),(0,t.jsx)(x.x,{fz:"sm",children:e.tasktypename})]},e.id)),(0,t.jsx)(i.o,{placeholder:"添加任务类型",value:s,onChange:e=>{_(e.currentTarget.value)}}),(0,t.jsx)(h.k,{mt:"xs",gap:"sm",justify:"flex-end",align:"center",direction:"row",wrap:"nowrap",children:(0,t.jsx)(o.z,{disabled:!s,onClick:async()=>{let{data:t,error:n}=await a.from("tasktype").insert([{tasktypename:s,user_id:e.id}]);n&&alert(n.message),_(""),H()},children:"add"})}),(0,t.jsx)(d.i,{my:"sm",variant:"dashed"}),(0,t.jsx)(p.Ph,{label:"选择任务类型",value:C,data:z,onChange:b}),(0,t.jsx)(i.o,{label:"任务",value:T,onChange:e=>{E(e.currentTarget.value)}}),(0,t.jsx)(l.Y,{label:"优先级",value:q,onChange:N}),(0,t.jsx)(h.k,{mt:"xs",gap:"sm",justify:"flex-end",align:"center",direction:"row",wrap:"nowrap",children:(0,t.jsx)(o.z,{disabled:!C||!T,onClick:async()=>{await a.from("tasks").insert([{power:q,task_name:T,user_id:e.id,tasktype:C,step:"init"}]),b(""),E(""),J()},children:"add"})}),(0,t.jsx)(d.i,{my:"sm",variant:"dashed"}),(0,t.jsx)(u.K,{children:D.map((e,s)=>(0,t.jsxs)(h.k,{gap:"xs",justify:"center",align:"center",direction:"row",wrap:"nowrap",children:[0===s&&(0,t.jsx)(g.A,{color:"blue",radius:"xl",variant:"light",onClick:async()=>{await a.from("task_stack").delete().eq("id",e.id),L()},children:(0,t.jsx)(w.IT9,{size:"1rem"})}),(0,t.jsx)(x.x,{fz:"xs",children:"".concat(e.task_name," / ").concat(e.current_frame," / ").concat(e.note)})]}))}),(0,t.jsx)(d.i,{my:"sm",variant:"dashed"}),A.map(e=>(0,t.jsxs)(k.x,{component:"div",mt:"md",mb:"sm",children:[(0,t.jsx)(x.x,{mt:"sm",fz:"lg",fw:500,c:"dimmed",children:e.tasktype}),e.list.map(e=>(0,t.jsxs)(k.x,{component:"div",children:[(0,t.jsxs)(h.k,{justify:"flex-start",gap:"xs",align:"center",direction:"row",wrap:"nowrap",children:[(0,t.jsx)(g.A,{color:"blue",radius:"xl",variant:"light",onClick:()=>{X({...e}),I()},children:(0,t.jsx)(w.TRY,{size:"1rem"})}),(0,t.jsx)(g.A,{color:"blue",radius:"xl",variant:"light",onClick:async()=>{W(e),B(!0)},children:(0,t.jsx)(w.Kjm,{size:"1rem"})}),(0,t.jsx)(g.A,{color:"blue",radius:"xl",variant:"light",onClick:async()=>{await a.from("tasks").delete().eq("id",e.id),J()},children:(0,t.jsx)(w.IT9,{size:"1rem"})}),(0,t.jsx)(x.x,{fz:"sm",fw:700,c:"blue",children:e.power}),(0,t.jsx)(j.X,{label:e.task_name,checked:e.active,onChange:async s=>{let t=s.currentTarget.checked;console.log("task id ".concat(e.id," checked ").concat(t)),await a.from("tasks").update({active:t}).eq("id",e.id),J()}})]}),(0,t.jsx)(x.x,{fz:"xs",c:"dimmed",mx:"xl",truncate:!0,lineClamp:1,children:e.step}),(0,t.jsx)(d.i,{my:"sm",variant:"dashed"})]},e.id))]},e.tasktype))]})]})}}},function(e){e.O(0,[584,402,566,774,888,179],function(){return e(e.s=8440)}),_N_E=e.O()}]);