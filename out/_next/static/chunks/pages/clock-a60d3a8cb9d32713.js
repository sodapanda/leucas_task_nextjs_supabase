(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[672],{5783:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/clock",function(){return s(8906)}])},8906:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return j}});var l=s(5893),a=s(7294),n=s(5117),i=s(9834),o=s(6155),r=s(4201),c=s(855),u=s(4053),d=s(3751),f=s(8668),m=s(3991);let h="runing",x="stoped",_="disabled",g="clickRun",k="clickStop",p=s(7177);function j(){let e=(0,u.useSupabaseClient)(),t=(0,u.useUser)(),[s,j]=(0,a.useState)([]),[w,y]=(0,a.useState)("00:00:00"),[v,b]=(0,a.useState)(!1),N=(0,r.Z)(new Date,"yyyy/MM/dd"),S=(0,a.useRef)(0),z=(0,a.useRef)(),[D,C]=(0,a.useState)({}),[M,E]=(0,a.useState)({}),[A,O]=(0,a.useState)(!1),{days:J,hours:T,minutes:q,seconds:R,isRunning:K,start:P,pause:Q,reset:X}=(0,d.useStopwatch)({autoStart:!1}),[Z,H]=(0,a.useState)([]);function I(){let e=function(){let e=new Date,t=(1-(60*e.getHours()+e.getMinutes())/1440)*100;return Math.floor(t)}();C({width:"".concat(e,"%")})}async function U(t){S.current=0;let s=JSON.parse(JSON.stringify(t));if(console.log(s=JSON.parse(JSON.stringify(s=s.map(e=>(e.status=void 0,e.clickDuration=void 0,e))))),await e.from("task_history").upsert(s,{onConflict:"id"}),!A){var l;null===(l=z.current)||void 0===l||l.play()}}function B(){e.from("task_history").select("*").eq("task_date",N).then(e=>{let{error:t,data:s}=e;!t&&s.length>0&&(s.map(e=>(e.status="stoped",e)),j(s))})}async function F(){let{data:s,error:l}=await e.from("tasks").select("*").eq("active",!0);if(l||!s||0==s.length){console.log("no data");return}s.map(e=>e.status="stoped"),function(e){for(let t=e.length-1;t>0;t--){let s=Math.floor(Math.random()*(t+1));[e[t],e[s]]=[e[s],e[t]]}}(s);let a=s.slice(),n=[];for(let e=0;e<3;e++){let e=a.reduce((e,t)=>e+t.power,0),t=Math.random()*e,s=0;for(let e of a)if((s+=e.power)>=t){n.push(e),a.splice(a.indexOf(e),1);break}}let i=[];for(let e of n)i.push({task_date:N,task_id:e.id,task_category:e.tasktype,task_name:e.task_name,duration:"00:00:00",user_id:null==t?void 0:t.id});let o=await e.from("task_history").insert(i);o.error&&console.log(o.error),B()}function G(e,t){let l=s.slice(),a=l.find(t=>t.id===e);a&&(t===g?(a.status=h,a.clickDuration=p.toS(a.duration),X()):t===k&&(a.status=x,Q()));let n=l.some(e=>e.status===h);if(n)for(let e of l)e.status!==h&&(e.status=_);else for(let e of l)e.status=x;j(l)}return(0,a.useEffect)(()=>(z.current=new Audio("/pop-up-something-160353.mp3"),B(),I(),e.from("daily_product_count").select("*").eq("task_date",N).then(e=>{let{error:t,data:s}=e;!t&&s.length>0&&y(s[0].total_count)}),e.from("daily_product_count").select("*").order("task_date",{ascending:!1}).then(e=>{var t;null===(t=e.data)||void 0===t||t.map(e=>{let t=p.toS(e.total_count);return e.isDone=!0,t<28800&&(e.isDone=!1),e.task_date_d=(0,c.Z)(e.task_date,"yyyy-MM-dd",new Date),e}),H(e.data)}),()=>{K&&Q()}),[]),(0,a.useEffect)(()=>{S.current=S.current+1;let e=s.slice(),t=e.find(e=>e.status===h);if(t){let s=t.clickDuration+(3600*T+60*q+R);t.duration=p.fromS(s,"hh:mm:ss");let l=0;for(let t of e)l+=p.toS(t.duration);y(p.fromS(l,"hh:mm:ss")),S.current>=10&&U(e)}j(e),I()},[R]),(0,a.useEffect)(()=>{(function(e){let t=p.toS(e);E({width:"".concat(Math.round((28800-t)*100/86400),"%")})})(w)},[w]),(0,a.useEffect)(()=>{s&&s.length>0?b(!1):b(!0)},[s]),(0,l.jsxs)("div",{className:"w-full",children:[(0,l.jsxs)("div",{className:"w-full flex flex-row items-center justify-around bg-blue-50",children:[(0,l.jsx)("h4",{children:N}),(0,l.jsx)(n.x,{c:"blue",fz:"lg",fw:700,children:w}),v&&(0,l.jsx)(i.A,{color:"blue",variant:"filled",onClick:F,children:(0,l.jsx)(m.Iwv,{size:18})}),(0,l.jsx)(i.A,{color:"blue",variant:"filled",onClick:()=>{O(!A)},children:A?(0,l.jsx)(m.d2K,{size:18}):(0,l.jsx)(m.Am6,{size:18})})]}),(0,l.jsx)("div",{className:"h-8 bg-red-50",style:D}),(0,l.jsx)("div",{className:"h-8 bg-green-50",style:M}),s.length>0&&s.map(e=>(0,l.jsxs)("div",{className:"flex flex-col mb-4 mt-2",children:[(0,l.jsx)(n.x,{size:"xs",className:"ml-2",children:e.task_category}),(0,l.jsx)(n.x,{className:"ml-2",fw:500,children:e.task_name}),(0,l.jsxs)("div",{className:"flex flex-row justify-between items-center mt-1 bg-blue-50",children:[(0,l.jsx)(n.x,{fw:700,c:"blue",className:"ml-2",children:e.duration}),e.status===x&&(0,l.jsx)(i.A,{className:"mr-2",color:"blue",variant:"filled",onClick:()=>{var t;console.log("start"),G(e.id,g),null===(t=z.current)||void 0===t||t.play()},children:(0,l.jsx)(m.Qig,{size:18})}),e.status===h&&(0,l.jsx)(i.A,{className:"mr-2",color:"blue",variant:"filled",onClick:()=>{console.log("start"),G(e.id,k)},children:(0,l.jsx)(m.z8K,{size:18})}),e.status===_&&(0,l.jsx)(i.A,{disabled:!0,className:"mr-2",color:"blue",variant:"filled",onClick:()=>{console.log("start")},children:(0,l.jsx)(m.Qig,{size:18})})]})]},e.id)),(0,l.jsx)(f.f,{onChange:e=>{console.log(e)},renderDay:e=>{let t=e.getDate(),s=Z.find(t=>t.task_date_d.getTime()===e.getTime()),a=!1;return s&&s.isDone&&(a=!0),(0,l.jsx)(o.z,{color:"green",position:"middle-center",size:15,disabled:!a,children:(0,l.jsx)("div",{children:t})})}})]})}}},function(e){e.O(0,[584,163,774,888,179],function(){return e(e.s=5783)}),_N_E=e.O()}]);