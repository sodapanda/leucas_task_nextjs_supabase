(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[966],{682:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/account",function(){return a(7738)}])},7738:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return n}});var l=a(5893),i=a(7294),r=a(4053);function s(e){let{uid:t,url:a,size:s,onUpload:n}=e,o=(0,r.useSupabaseClient)(),[u,d]=(0,i.useState)(null),[c,h]=(0,i.useState)(!1);(0,i.useEffect)(()=>{async function e(e){try{let{data:t,error:a}=await o.storage.from("avatars").download(e);if(a)throw a;let l=URL.createObjectURL(t);d(l)}catch(e){console.log("Error downloading image: ",e)}}a&&e(a)},[a,o.storage]);let f=async e=>{try{if(h(!0),!e.target.files||0===e.target.files.length)throw Error("You must select an image to upload.");let a=e.target.files[0],l=a.name.split(".").pop(),i="".concat(t,".").concat(l),r="".concat(i),{error:s}=await o.storage.from("avatars").upload(r,a,{upsert:!0});if(s)throw s;n(r)}catch(e){alert("Error uploading avatar!"),console.log(e)}finally{h(!1)}};return(0,l.jsxs)("div",{children:[u?(0,l.jsx)("img",{src:u,alt:"Avatar",className:"avatar image",style:{height:s,width:s}}):(0,l.jsx)("div",{className:"avatar no-image",style:{height:s,width:s}}),(0,l.jsxs)("div",{style:{width:s},children:[(0,l.jsx)("label",{className:"button primary block",htmlFor:"single",children:c?"Uploading ...":"Upload"}),(0,l.jsx)("input",{style:{visibility:"hidden",position:"absolute"},type:"file",id:"single",accept:"image/*",onChange:f,disabled:c})]})]})}function n(){let e=(0,r.useSupabaseClient)(),t=(0,r.useUser)(),[a,n]=(0,i.useState)(!0),[o,u]=(0,i.useState)(null),[d,c]=(0,i.useState)(null),[h,f]=(0,i.useState)(null),g=(0,r.useSession)();async function p(a){let{username:l,website:i,avatar_url:r}=a;try{if(n(!0),!t)throw Error("No user");let a={id:null==t?void 0:t.id,username:l,website:i,avatar_url:r,updated_at:new Date().toISOString()},{error:s}=await e.from("profiles").upsert(a);if(s)throw s;alert("Profile updated!")}catch(e){alert("Error updating the data!"),console.log(e)}finally{n(!1)}}return(0,i.useEffect)(()=>{(async function(){try{if(n(!0),!t)throw Error("No user");let{data:a,error:l,status:i}=await e.from("profiles").select("username, website, avatar_url").eq("id",null==t?void 0:t.id).single();if(l&&406!==i)throw l;a&&(u(a.username),c(a.website),f(a.avatar_url))}catch(e){alert("Error loading user data!"),console.log(e)}finally{n(!1)}})()},[g,t,e]),(0,l.jsxs)("div",{className:"form-widget",children:[(0,l.jsx)(s,{uid:(null==t?void 0:t.id)||"",url:h,size:150,onUpload:e=>{f(e),p({username:o,website:d,avatar_url:e})}}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{htmlFor:"email",children:"Email"}),(0,l.jsx)("input",{id:"email",type:"text",value:null==g?void 0:g.user.email,disabled:!0})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{htmlFor:"username",children:"Username"}),(0,l.jsx)("input",{id:"username",type:"text",value:o||"",onChange:e=>u(e.target.value)})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{htmlFor:"website",children:"Website"}),(0,l.jsx)("input",{id:"website",type:"website",value:d||"",onChange:e=>c(e.target.value)})]}),(0,l.jsx)("div",{children:(0,l.jsx)("button",{className:"button primary block",onClick:()=>p({username:o,website:d,avatar_url:h}),disabled:a,children:a?"Loading ...":"Update"})}),(0,l.jsx)("div",{children:(0,l.jsx)("button",{className:"button block",onClick:()=>e.auth.signOut(),children:"Sign Out"})})]})}}},function(e){e.O(0,[774,888,179],function(){return e(e.s=682)}),_N_E=e.O()}]);