(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[632],{8440:function(e,a,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/tasklist",function(){return t(6277)}])},6277:function(e,a,t){"use strict";t.r(a),t.d(a,{default:function(){return f}});var s=t(5893),n=t(1232),i=t(5117),l=t(61),c=t(7841),r=t(4777),d=t(3940),o=t(4127),u=t(7414),k=t(211),m=t(9834),h=t(3991),p=t(7294),x=t(4053);function f(){let e=(0,x.useUser)(),a=(0,x.useSupabaseClient)(),[t,f]=(0,p.useState)(""),[y,j]=(0,p.useState)(""),[g,v]=(0,p.useState)([]),[_,w]=(0,p.useState)(""),[b,C]=(0,p.useState)(5),[E,S]=(0,p.useState)([]);async function T(){let{data:e,error:t}=await a.from("tasktype").select("*");t&&alert(t.message),e.forEach(e=>{e.label=e.tasktypename,e.value=e.tasktypename}),v(e)}async function N(){let{data:e,error:t}=await a.from("tasks").select("*").order("id",{ascending:!1});if(console.log(e),!t&&e){let a=e.reduce((e,a)=>{let t=e.find(e=>e.tasktype===a.tasktype);return t?t.list.push(a):e.push({tasktype:a.tasktype,list:[a]}),e},[]);console.log(a),S(a)}}return(0,p.useEffect)(()=>{T(),N()},[]),(0,s.jsxs)("div",{className:"w-ful mt-4",children:[g.map(e=>(0,s.jsxs)(n.Z,{mb:"xs",ml:"xs",children:[(0,s.jsx)(m.A,{color:"blue",radius:"xl",variant:"light",onClick:async()=>{let{data:t,error:s}=await a.from("tasktype").delete().eq("id",e.id);s&&alert("".concat(s.message)),T()},children:(0,s.jsx)(h.IT9,{size:"1.125rem"})}),(0,s.jsx)(i.x,{fz:"sm",children:e.tasktypename})]},e.id)),(0,s.jsx)(l.o,{placeholder:"添加任务类型",value:t,onChange:e=>{f(e.currentTarget.value)}}),(0,s.jsx)(c.z,{disabled:!t,onClick:async()=>{let{data:s,error:n}=await a.from("tasktype").insert([{tasktypename:t,user_id:e.id}]);n&&alert(n.message),f(""),T()},children:"add"}),(0,s.jsx)(r.i,{my:"sm",variant:"dashed"}),(0,s.jsx)(d.Ph,{label:"选择任务类型",value:y,data:g,onChange:j}),(0,s.jsx)(l.o,{label:"任务",value:_,onChange:e=>{w(e.currentTarget.value)}}),(0,s.jsx)(o.Y,{label:"优先级",value:b,onChange:C}),(0,s.jsx)(c.z,{disabled:!y||!_,onClick:async()=>{await a.from("tasks").insert([{power:b,task_name:_,user_id:e.id,tasktype:y}]),j(""),w(""),N()},children:"add"}),(0,s.jsx)(r.i,{my:"sm",variant:"dashed"}),E.map(e=>(0,s.jsxs)(u.x,{component:"div",children:[(0,s.jsx)(i.x,{children:e.tasktype}),e.list.map(e=>(0,s.jsxs)(n.Z,{position:"apart",mt:"xs",mx:"xs",children:[(0,s.jsx)(k.X,{label:e.task_name,checked:e.active,onChange:async t=>{let s=t.currentTarget.checked;console.log("task id ".concat(e.id," checked ").concat(s)),await a.from("tasks").update({active:s}).eq("id",e.id),N()}}),(0,s.jsx)(m.A,{color:"blue",radius:"xl",variant:"light",onClick:async()=>{await a.from("tasks").delete().eq("id",e.id),N()},children:(0,s.jsx)(h.IT9,{size:"1.125rem"})})]},e.id))]},e.tasktype))]})}}},function(e){e.O(0,[584,612,774,888,179],function(){return e(e.s=8440)}),_N_E=e.O()}]);