(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[632],{8440:function(e,a,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/tasklist",function(){return s(6277)}])},6277:function(e,a,s){"use strict";s.r(a),s.d(a,{default:function(){return v}});var t=s(5893),n=s(8049),i=s(1017),l=s(4127),r=s(4777),d=s(2615),c=s(7841),o=s(1232),u=s(5117),m=s(61),x=s(9876),p=s(1365),h=s(4523),f=s(7328),k=s(1759),j=s(9834),w=s(3991),g=s(7294),y=s(4053);function v(){let e=(0,y.useUser)(),a=(0,y.useSupabaseClient)(),[s,v]=(0,g.useState)(""),[b,C]=(0,g.useState)(""),[_,z]=(0,g.useState)([]),[T,S]=(0,g.useState)(""),[E,N]=(0,g.useState)(5),[q,Y]=(0,g.useState)([]),[A,{open:P,close:R}]=(0,k.q)(!1),[X,I]=(0,g.useState)({});async function O(){let{data:e,error:s}=await a.from("tasktype").select("*");s&&alert(s.message),e.forEach(e=>{e.label=e.tasktypename,e.value=e.tasktypename}),z(e)}async function Z(){let{data:e,error:s}=await a.from("tasks").select("*").order("id",{ascending:!1});if(console.log(e),!s&&e){let a=e.reduce((e,a)=>{let s=e.find(e=>e.tasktype===a.tasktype);return s?s.list.push(a):e.push({tasktype:a.tasktype,list:[a]}),e},[]);console.log(a),Y(a)}}return(0,g.useEffect)(()=>{O(),Z()},[]),(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.u,{opened:A,onClose:R,children:(0,t.jsxs)(i.Z,{shadow:"sm",padding:"lg",radius:"md",withBorder:!0,children:[(0,t.jsx)(l.Y,{value:X.power,onChange:async e=>{I({...X,power:e})}}),(0,t.jsx)(r.i,{my:"sm",variant:"dashed"}),(0,t.jsx)(d.g,{placeholder:"Your comment",label:"随手记录",autosize:!0,minRows:2,maxRows:10,value:X.step,onChange:e=>{let a=e.currentTarget.value;I({...X,step:a})}}),(0,t.jsx)(r.i,{my:"sm",variant:"dashed"}),(0,t.jsx)(c.z,{variant:"light",color:"blue",fullWidth:!0,mt:"md",radius:"md",onClick:async()=>{await a.from("tasks").update({power:X.power,step:X.step}).eq("id",X.id),Z(),R()},children:"save"})]})}),(0,t.jsxs)("div",{className:"w-ful mt-4",children:[_.map(e=>(0,t.jsxs)(o.Z,{mb:"xs",ml:"xs",children:[(0,t.jsx)(j.A,{color:"blue",radius:"xl",variant:"light",onClick:async()=>{let{data:s,error:t}=await a.from("tasktype").delete().eq("id",e.id);t&&alert("".concat(t.message)),O()},children:(0,t.jsx)(w.IT9,{size:"1rem"})}),(0,t.jsx)(u.x,{fz:"sm",children:e.tasktypename})]},e.id)),(0,t.jsx)(m.o,{placeholder:"添加任务类型",value:s,onChange:e=>{v(e.currentTarget.value)}}),(0,t.jsx)(x.k,{mt:"xs",gap:"sm",justify:"flex-end",align:"center",direction:"row",wrap:"nowrap",children:(0,t.jsx)(c.z,{disabled:!s,onClick:async()=>{let{data:t,error:n}=await a.from("tasktype").insert([{tasktypename:s,user_id:e.id}]);n&&alert(n.message),v(""),O()},children:"add"})}),(0,t.jsx)(r.i,{my:"sm",variant:"dashed"}),(0,t.jsx)(p.Ph,{label:"选择任务类型",value:b,data:_,onChange:C}),(0,t.jsx)(m.o,{label:"任务",value:T,onChange:e=>{S(e.currentTarget.value)}}),(0,t.jsx)(l.Y,{label:"优先级",value:E,onChange:N}),(0,t.jsx)(x.k,{mt:"xs",gap:"sm",justify:"flex-end",align:"center",direction:"row",wrap:"nowrap",children:(0,t.jsx)(c.z,{disabled:!b||!T,onClick:async()=>{await a.from("tasks").insert([{power:E,task_name:T,user_id:e.id,tasktype:b,step:"init"}]),C(""),S(""),Z()},children:"add"})}),(0,t.jsx)(r.i,{my:"sm",variant:"dashed"}),q.map(e=>(0,t.jsxs)(h.x,{component:"div",mt:"md",mb:"sm",children:[(0,t.jsx)(u.x,{mt:"sm",fz:"lg",fw:500,c:"dimmed",children:e.tasktype}),e.list.map(e=>(0,t.jsxs)(h.x,{component:"div",children:[(0,t.jsxs)(x.k,{justify:"flex-start",gap:"xs",align:"center",direction:"row",wrap:"nowrap",children:[(0,t.jsx)(j.A,{color:"blue",radius:"xl",variant:"light",onClick:()=>{I({...e}),P()},children:(0,t.jsx)(w.TRY,{size:"1rem"})}),(0,t.jsx)(j.A,{color:"blue",radius:"xl",variant:"light",onClick:async()=>{await a.from("tasks").delete().eq("id",e.id),Z()},children:(0,t.jsx)(w.IT9,{size:"1rem"})}),(0,t.jsx)(u.x,{fz:"sm",fw:700,c:"blue",children:e.power}),(0,t.jsx)(f.X,{label:e.task_name,checked:e.active,onChange:async s=>{let t=s.currentTarget.checked;console.log("task id ".concat(e.id," checked ").concat(t)),await a.from("tasks").update({active:t}).eq("id",e.id),Z()}})]}),(0,t.jsx)(u.x,{fz:"xs",c:"dimmed",mx:"xl",truncate:!0,lineClamp:1,children:e.step}),(0,t.jsx)(r.i,{my:"sm",variant:"dashed"})]},e.id))]},e.tasktype))]})]})}}},function(e){e.O(0,[584,402,566,774,888,179],function(){return e(e.s=8440)}),_N_E=e.O()}]);